# 中签结果费用项目进一步优化修改说明

## 修改概述
本次修改基于之前的费用项目优化，进一步调整了中签结果页面的费用计算和显示：
1. 完全去除印花税费用项（中签时不需要印花税）
2. 更新费用项目名称以更准确反映实际业务
3. 确保相关页面数据一致性

## 修改内容

### 1. 去除印花税
- **原因**：中签时不需要缴纳印花税，印花税只在卖出时产生
- **影响**：减少了中签时的总费用
- **计算调整**：总费用计算中移除印花税

### 2. 费用名称进一步优化
| 原名称 | 新名称 |
|--------|--------|
| 联交所交易费 | 香港联交所交易费 |
| 交易所交易会费 | 证监会交易会费 |

### 3. 最终费用列表
更新后的中签费用明细（无印花税）：

| 费用项目 | 计算比例 | 计算公式 |
|----------|----------|----------|
| 经纪佣金 | 1% | 中签金额 × 0.01 |
| 香港联交所交易费 | 0.00565% | 中签金额 × 0.0000565 |
| 证监会交易会费 | 0.0027% | 中签金额 × 0.000027 |
| 会财局交易会费 | 0.00015% | 中签金额 × 0.0000015 |
| 打新套餐费用 | 固定金额 | 用户输入的套餐费 |

**总费用** = 经纪佣金 + 香港联交所交易费 + 证监会交易会费 + 会财局交易会费 + 打新套餐费用

**注意**：印花税已从中签费用中移除，仅在卖出时计算。

## 修改文件

### 1. JavaScript文件修改
**文件**: `pages/winning-result/winning-result.js`

#### 数据结构更新（移除印花税）
```javascript
feeDetails: {
  brokerageCommission: '0.00', // 经纪佣金
  tradingFee: '0.00',       // 香港联交所交易费
  tradingLevy: '0.00',      // 证监会交易会费
  afrcLevy: '0.00',         // 会财局交易会费
  packageFee: '0.00',       // 打新套餐费用
  totalFee: '0.00'          // 总费用
}
```

#### 费用计算逻辑更新（移除印花税）
```javascript
calculateFees(winningShares, issuePrice, packageFee) {
  const baseAmount = winningShares * issuePrice
  
  // 移除印花税计算
  const brokerageCommission = Math.round(baseAmount * 0.01 * 100) / 100  // 经纪佣金 1%
  const tradingFee = Math.round(baseAmount * 0.0000565 * 100) / 100  // 香港联交所交易费 0.00565%
  const tradingLevy = Math.round(baseAmount * 0.000027 * 100) / 100  // 证监会交易会费 0.0027%
  const afrcLevy = Math.round(baseAmount * 0.0000015 * 100) / 100  // 会财局交易会费 0.00015%
  
  // 总费用（无印花税）
  const totalFee = Math.round((brokerageCommission + tradingFee + tradingLevy + afrcLevy + packageFee) * 100) / 100
  
  return {
    brokerageCommission: brokerageCommission.toFixed(2),
    tradingFee: tradingFee.toFixed(2),
    tradingLevy: tradingLevy.toFixed(2),
    afrcLevy: afrcLevy.toFixed(2),
    packageFee: packageFee.toFixed(2),
    totalFee: totalFee.toFixed(2)
  }
}
```

### 2. WXML文件修改
**文件**: `pages/winning-result/winning-result.wxml`

#### 费用明细显示（移除印花税，更新名称）
```wxml
<view class="fee-details">
  <view class="fee-title">应收费用明细</view>
  <!-- 移除印花税项目 -->
  <view class="fee-item">
    <text class="fee-label">经纪佣金 (1%)：</text>
    <text class="fee-value">¥{{feeDetails.brokerageCommission}}</text>
  </view>
  <view class="fee-item">
    <text class="fee-label">香港联交所交易费 (0.00565%)：</text>
    <text class="fee-value">¥{{feeDetails.tradingFee}}</text>
  </view>
  <view class="fee-item">
    <text class="fee-label">证监会交易会费 (0.0027%)：</text>
    <text class="fee-value">¥{{feeDetails.tradingLevy}}</text>
  </view>
  <view class="fee-item">
    <text class="fee-label">会财局交易会费 (0.00015%)：</text>
    <text class="fee-value">¥{{feeDetails.afrcLevy}}</text>
  </view>
  <view class="fee-item">
    <text class="fee-label">打新套餐费用：</text>
    <text class="fee-value">¥{{feeDetails.packageFee}}</text>
  </view>
  <view class="fee-total">
    <text class="fee-total-label">总费用：</text>
    <text class="fee-total-value">¥{{feeDetails.totalFee}}</text>
  </view>
</view>
```

### 3. 编辑页面更新
**文件**: `pages/add-stock/add-stock.wxml`

#### 中签费用明细显示（移除印花税，更新名称）
```wxml
<view class="fee-details" wx:if="{{formData.winningFeeDetails}}">
  <view class="fee-title">中签费用明细</view>
  <!-- 移除印花税项目 -->
  <view class="fee-item">
    <text class="fee-label">经纪佣金：</text>
    <text class="fee-value">¥{{formData.winningFeeDetails.brokerageCommission || '0.00'}}</text>
  </view>
  <view class="fee-item">
    <text class="fee-label">香港联交所交易费：</text>
    <text class="fee-value">¥{{formData.winningFeeDetails.tradingFee}}</text>
  </view>
  <view class="fee-item">
    <text class="fee-label">证监会交易会费：</text>
    <text class="fee-value">¥{{formData.winningFeeDetails.tradingLevy}}</text>
  </view>
  <view class="fee-item">
    <text class="fee-label">会财局交易会费：</text>
    <text class="fee-value">¥{{formData.winningFeeDetails.afrcLevy}}</text>
  </view>
  <view class="fee-item">
    <text class="fee-label">套餐费用：</text>
    <text class="fee-value">¥{{formData.winningFeeDetails.packageFee}}</text>
  </view>
  <view class="fee-total">
    <text class="fee-total-label">总费用：</text>
    <text class="fee-total-value">¥{{formData.winningFeeDetails.totalFee}}</text>
  </view>
</view>
```

## 计算示例

假设中签信息：
- 中签股数：100股
- 发行价：¥79.00
- 中签金额：100 × 79 = ¥7,900

费用计算（无印花税）：
1. **经纪佣金**：7,900 × 1% = ¥79.00
2. **香港联交所交易费**：7,900 × 0.00565% = ¥0.45
3. **证监会交易会费**：7,900 × 0.0027% = ¥0.21
4. **会财局交易会费**：7,900 × 0.00015% = ¥0.01
5. **打新套餐费用**：¥100.00（假设）

**总费用**：¥79.00 + ¥0.45 + ¥0.21 + ¥0.01 + ¥100.00 = **¥179.67**

**与之前对比**：
- 之前总费用（含印花税）：¥187.57
- 现在总费用（无印花税）：¥179.67
- **减少**：¥7.90（印花税金额）

## 数据兼容性

### 向后兼容
- 对于已存在的中签记录，编辑页面会正常显示所有费用项目
- 如果旧数据中包含`stampDuty`字段，在显示时会被忽略
- 卖出计算仍然使用`winningFeeDetails.totalFee`进行费用计算

### 卖出页面不受影响
- 卖出记录页面的印花税保持不变，因为卖出时确实需要缴纳印花税
- 卖出时的费用项目独立于中签费用项目

## 业务逻辑说明

### 中签vs卖出的费用差异
1. **中签时费用**（本次修改）：
   - 经纪佣金
   - 香港联交所交易费
   - 证监会交易会费
   - 会财局交易会费
   - 打新套餐费用
   - **无印花税**

2. **卖出时费用**（保持不变）：
   - 印花税
   - 交易徵费
   - 交易费
   - 结算费
   - 佣金

## 测试建议

### 1. 功能测试
- [ ] 新建中签记录，验证无印花税费用项
- [ ] 验证费用名称显示为新名称
- [ ] 验证总费用计算正确（不含印花税）

### 2. 兼容性测试
- [ ] 编辑包含印花税的旧中签记录，确保正常显示
- [ ] 验证卖出计算仍然正常使用总费用

### 3. 业务逻辑测试
- [ ] 确认中签页面无印花税
- [ ] 确认卖出页面仍有印花税
- [ ] 验证费用计算金额减少了印花税部分

## 完成时间
2025年7月14日

## 注意事项
1. **印花税处理**：完全从中签费用中移除，仅在卖出时计算
2. **总费用变化**：中签总费用会比之前减少印花税金额
3. **名称准确性**：更新后的费用名称更准确反映监管机构
4. **数据一致性**：确保中签页面和编辑页面显示一致
