# 总手续费计算逻辑修正说明

## 问题识别
之前的理解有误，用户指出：
- **总手续费应该就是 `feeDetails.totalFee`**（卖出费用明细里的总费用）
- **不应该包含买入费用**

## 修正内容

### 1. JavaScript计算逻辑修正

#### 修正前
```javascript
// 错误：总费用 = 买入费用 + 卖出费用
const totalFees = buyFees + parseFloat(feeDetails.totalFee)

// 错误：净盈亏只减去总费用
const profit = sellAmount - costAmount - totalFees
```

#### 修正后
```javascript
// 正确：总手续费就是卖出费用明细里的总费用
const totalFees = parseFloat(feeDetails.totalFee)

// 正确：净盈亏需要分别减去买入费用和卖出费用
const profit = sellAmount - costAmount - buyFees - totalFees
```

### 2. 界面显示修正

#### 费用明细卡片
```
卖出费用明细
├── 佣金：¥75.00
├── 印花税 (0.1%)：¥X.XX
├── 交易徵费 (0.00285%)：¥X.XX
├── 交易费 (0.00565%)：¥X.XX
├── 结算费 (0.002%，最低¥3)：¥X.XX
└── 总费用：¥X.XX  ← 这就是总手续费
```

#### 盈亏计算结果
```
├── 卖出金额：¥X.XX
├── 成本金额：¥X.XX
├── 买入费用：¥X.XX
├── 总手续费：¥X.XX  ← 等于上面费用明细的总费用
├── 净盈亏：¥X.XX
└── 收益率：X.XX%
```

### 3. 计算公式确认

#### 总手续费
```javascript
总手续费 = feeDetails.totalFee
```

#### 净盈亏计算
```javascript
净盈亏 = 卖出金额 - 成本金额 - 买入费用 - 总手续费
```

其中：
- 卖出金额 = 卖出股数 × 卖出价格
- 成本金额 = 卖出股数 × 发行价
- 买入费用 = (服务费 + 套餐费) × 卖出比例
- 总手续费 = 佣金 + 印花税 + 交易徵费 + 交易费 + 结算费

## 验证示例

### 假设数据
- 中签股数：1000股
- 发行价：8港元
- 卖出价：10港元
- 卖出股数：1000股
- 服务费：100港元
- 套餐费：50港元

### 计算过程

#### 卖出费用明细（总手续费）
```
卖出金额 = 1000 × 10 = 10,000港元

佣金 = 75.00港元
印花税 = 10,000 × 0.001 = 10.00港元
交易徵费 = 10,000 × 0.0000285 = 0.29港元
交易费 = 10,000 × 0.0000565 = 0.57港元
结算费 = max(10,000 × 0.00002, 3.00) = 3.00港元

总手续费 = 75.00 + 10.00 + 0.29 + 0.57 + 3.00 = 88.86港元
```

#### 其他计算
```
卖出金额 = 10,000.00港元
成本金额 = 8,000.00港元
买入费用 = (100 + 50) × 1.0 = 150.00港元
总手续费 = 88.86港元

净盈亏 = 10,000.00 - 8,000.00 - 150.00 - 88.86 = 1,761.14港元
收益率 = (1,761.14 / 8,000.00) × 100% = 22.01%
```

## 关键要点

1. **总手续费定义明确**：总手续费就是卖出时产生的各项费用之和
2. **买入费用独立计算**：买入费用不包含在总手续费中，但在净盈亏计算时需要扣除
3. **界面显示清晰**：用户能清楚看到买入费用和总手续费分别是多少
4. **计算逻辑正确**：净盈亏正确地扣除了所有相关费用

---
*修正时间：2025年7月12日*
*状态：已修正*
