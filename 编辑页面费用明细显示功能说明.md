# 编辑打新记录页面费用明细显示功能说明

## 功能概述
在编辑打新记录页面（add-stock页面的编辑模式）中，为中签信息和卖出信息部分添加了详细的费用明细显示，同时将时间显示简化为只显示日期。

## 新增功能

### 1. 中签信息费用明细
在中签信息卡片中添加了完整的费用明细显示：

#### 显示内容
- **印花税**：按中签金额0.1%计算
- **交易费**：按中签金额0.00565%计算  
- **交易征费**：按中签金额0.0027%计算
- **会财局交易征费**：按中签金额0.00015%计算
- **套餐费用**：用户设定的套餐费用
- **总费用**：所有费用项目的合计

#### 数据来源
费用明细来自中签结果页面保存的`winningFeeDetails`数据。

### 2. 卖出信息费用明细
在卖出信息卡片中添加了完整的费用明细显示：

#### 显示内容
- **佣金**：固定75港元
- **印花税**：按卖出金额0.1%计算
- **交易徵费**：按卖出金额0.00285%计算
- **交易费**：按卖出金额0.00565%计算
- **结算费**：按卖出金额0.002%计算，最低3港元
- **总费用**：所有费用项目的合计

#### 数据来源
费用明细来自卖出信息页面保存的`sellFeeDetails`数据。

### 3. 时间显示优化
- **修改前**：显示完整的日期时间（如：2025-07-12 14:30）
- **修改后**：只显示日期（如：2025-07-12）
- **字段名称**：
  - 中签时间 → 中签日期
  - 卖出时间 → 卖出日期

## 技术实现

### 1. WXML结构修改

#### 中签信息费用明细
```xml
<!-- 中签费用明细 -->
<view class="fee-details" wx:if="{{formData.winningFeeDetails}}">
  <view class="fee-title">中签费用明细</view>
  <view class="fee-item">
    <text class="fee-label">印花税：</text>
    <text class="fee-value">¥{{formData.winningFeeDetails.stampDuty}}</text>
  </view>
  <!-- 其他费用项目... -->
  <view class="fee-total">
    <text class="fee-total-label">总费用：</text>
    <text class="fee-total-value">¥{{formData.winningFeeDetails.totalFee}}</text>
  </view>
</view>
```

#### 卖出信息费用明细
```xml
<!-- 卖出费用明细 -->
<view class="fee-details" wx:if="{{formData.sellFeeDetails}}">
  <view class="fee-title">卖出费用明细</view>
  <view class="fee-item">
    <text class="fee-label">佣金：</text>
    <text class="fee-value">¥{{formData.sellFeeDetails.commission}}</text>
  </view>
  <!-- 其他费用项目... -->
  <view class="fee-total">
    <text class="fee-total-label">总费用：</text>
    <text class="fee-total-value">¥{{formData.sellFeeDetails.totalFee}}</text>
  </view>
</view>
```

### 2. JavaScript逻辑修改

#### 新增formatDate方法
```javascript
formatDate(timestamp) {
  const date = new Date(timestamp)
  const year = date.getFullYear()
  const month = (date.getMonth() + 1).toString().padStart(2, '0')
  const day = date.getDate().toString().padStart(2, '0')
  return `${year}-${month}-${day}`
}
```

#### 时间格式化调用
```javascript
// 格式化时间显示
if (formData.winningTime) {
  formData.winningDateStr = this.formatDate(formData.winningTime)
}
if (formData.sellTime) {
  formData.sellDateStr = this.formatDate(formData.sellTime)
}
```

### 3. CSS样式新增

#### 费用明细卡片样式
```css
.fee-details {
  background-color: #f8f9fa;
  border-radius: 15rpx;
  padding: 25rpx;
  margin-top: 20rpx;
  border-left: 6rpx solid #ff7675;
}

.fee-title {
  font-size: 26rpx;
  font-weight: bold;
  color: #333;
  margin-bottom: 20rpx;
  text-align: center;
}

.fee-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12rpx;
}
```

## 显示条件

### 中签费用明细
- 条件：`formData.winningFeeDetails`存在
- 说明：只有在中签结果页面录入过中签信息且保存了费用明细才会显示

### 卖出费用明细  
- 条件：`formData.sellFeeDetails`存在
- 说明：只有在卖出信息页面录入过卖出信息且保存了费用明细才会显示

## 用户体验提升

### 1. 信息透明度
- 用户可以清楚看到每一笔费用的具体构成
- 了解港股打新的真实成本结构
- 方便核对和验证费用计算

### 2. 界面友好性
- 费用明细使用独立的卡片样式，层次分明
- 总费用突出显示，重点信息一目了然
- 时间显示简化，减少信息冗余

### 3. 数据完整性
- 展示所有相关的费用项目
- 保持与录入页面的数据一致性
- 支持历史数据的完整回顾

## 兼容性处理

### 历史数据兼容
- 对于没有费用明细的历史记录，不显示费用明细卡片
- 时间格式化兼容原有的时间戳数据
- 保持原有功能正常运行

### 条件渲染
- 使用`wx:if`条件渲染，确保只在有数据时显示
- 避免空数据造成的显示异常
- 保持页面布局的稳定性

## 实现状态

### ✅ 已完成功能
1. **中签费用明细显示** - 完整显示印花税、交易费、交易征费、会财局交易征费、套餐费用
2. **卖出费用明细显示** - 完整显示佣金、印花税、交易徵费、交易费、结算费
3. **时间显示优化** - 中签时间和卖出时间只显示日期，不显示具体时分
4. **样式设计完善** - 费用明细卡片样式美观，总费用突出显示
5. **兼容性处理** - 历史数据兼容，条件渲染避免异常

### 📁 涉及文件
- `pages/add-stock/add-stock.js` - 时间格式化逻辑
- `pages/add-stock/add-stock.wxml` - 费用明细显示结构
- `pages/add-stock/add-stock.wxss` - 费用明细样式

### 🎯 用户体验
- 信息透明：用户可以清楚看到每笔费用的构成
- 界面友好：独立卡片样式，层次分明
- 数据完整：与录入页面数据保持一致

---
*实现时间：2025年7月12日*
*版本：v2.1*
*状态：✅ 已完成实现*
