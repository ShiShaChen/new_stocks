# 多账户管理功能实现说明

## 功能概述
为港股打新记录小程序添加了完整的多账户管理功能，支持用户管理多个打新账户，确保不同账户的数据完全隔离。

## 主要功能

### 1. 账户管理
- ✅ **创建账户**：用户可以手动创建多个账户
- ✅ **默认账户**：系统自动创建"默认账户"
- ✅ **账户切换**：快速切换不同账户
- ✅ **账户显示**：在各页面显示当前账户信息

### 2. 数据隔离
- ✅ **按账户过滤**：所有数据按当前账户过滤显示
- ✅ **账户关联**：新增数据自动关联当前账户
- ✅ **统计分离**：统计数据按账户独立计算

### 3. 交互优化
- ✅ **引导创建**：首次使用时引导创建账户
- ✅ **快速切换**：在"我的"页面快速切换账户
- ✅ **账户提示**：页面标题显示当前账户名称

## 实现细节

### 1. 数据结构设计

#### 账户数据结构
```javascript
{
  id: 'account_1234567890',     // 唯一标识
  name: '港股账户A',            // 账户名称
  isDefault: false,             // 是否默认账户
  createTime: 1625097600000     // 创建时间
}
```

#### 股票记录数据结构
```javascript
{
  id: 'stock_1234567890',
  accountId: 'account_1234567890',  // 新增：关联账户ID
  stockName: '腾讯控股',
  // ... 其他字段
}
```

### 2. 核心功能实现

#### 账户初始化
```javascript
// 初始化账户系统
initializeAccounts() {
  const accounts = wx.getStorageSync('accounts') || []
  
  // 如果没有账户，创建默认账户
  if (accounts.length === 0) {
    const defaultAccount = {
      id: 'default',
      name: '默认账户',
      isDefault: true,
      createTime: new Date().getTime()
    }
    accounts.push(defaultAccount)
    wx.setStorageSync('accounts', accounts)
  }
}
```

#### 数据过滤
```javascript
// 按当前账户过滤数据
const accountStocks = stocks.filter(stock => {
  const stockAccountId = stock.accountId || 'default'
  return stockAccountId === currentAccountId
})
```

#### 账户切换
```javascript
// 切换账户并刷新数据
onSelectAccount(e) {
  const account = e.currentTarget.dataset.account
  
  // 保存当前选中的账户
  wx.setStorageSync('currentAccountId', account.id)
  
  // 通知其他页面刷新数据
  wx.setStorageSync('accountChanged', true)
}
```

### 3. 页面改造

#### "我的"页面 (profile)
- 显示当前账户信息
- 账户切换功能
- 账户创建和管理
- 账户列表展示

#### 新增记录页面 (add-stock)
- 账户选择器
- 自动关联当前账户
- 支持创建新账户
- 账户选择弹窗

#### 首页 (index)
- 按账户过滤数据显示
- 标题显示当前账户
- 统计数据独立计算

## 用户交互流程

### 1. 首次使用流程
1. 用户登录后自动创建"默认账户"
2. 用户可以在"我的"页面创建新账户
3. 新增打新记录时自动关联当前账户

### 2. 账户管理流程
1. 在"我的"页面点击"切换账户"
2. 选择目标账户或创建新账户
3. 系统自动切换并刷新所有页面数据

### 3. 数据录入流程
1. 选择"新增打新记录"
2. 首先选择所属账户（默认为当前账户）
3. 如果没有账户，引导用户创建
4. 完成数据录入并自动关联账户

## 技术特点

### 1. 数据安全
- 账户数据独立存储
- 数据隔离完全彻底
- 支持数据迁移和备份

### 2. 性能优化
- 懒加载账户数据
- 按需过滤显示数据
- 缓存当前账户信息

### 3. 用户体验
- 无缝切换账户
- 智能默认选择
- 清晰的视觉提示

## 修改的文件

### 新增功能
- `/pages/profile/profile.wxml` - 新增账户管理界面
- `/pages/profile/profile.wxss` - 新增账户管理样式
- `/pages/profile/profile.js` - 新增账户管理逻辑

### 功能增强
- `/pages/add-stock/add-stock.wxml` - 新增账户选择器
- `/pages/add-stock/add-stock.wxss` - 新增选择器样式
- `/pages/add-stock/add-stock.js` - 新增账户关联逻辑
- `/pages/index/index.js` - 新增账户过滤逻辑

## 使用说明

### 1. 账户创建
- 在"我的"页面点击"管理账户"
- 点击"+ 新增账户"按钮
- 输入账户名称并保存

### 2. 账户切换
- 在"我的"页面点击"切换账户"
- 选择目标账户
- 系统自动刷新所有数据

### 3. 数据录入
- 新增记录时选择所属账户
- 系统自动关联当前账户
- 支持临时创建新账户

## 注意事项

### 1. 数据兼容性
- 历史数据自动关联"默认账户"
- 支持数据迁移到其他账户
- 保持向后兼容性

### 2. 用户引导
- 首次使用时有明确提示
- 无账户时引导创建
- 提供"默认账户"选项

### 3. 错误处理
- 账户名称重复检查
- 数据完整性验证
- 异常情况恢复机制

这个多账户管理功能完全满足了港股打新记录的需求，用户可以轻松管理多个账户的打新数据，确保数据隔离和安全性。
