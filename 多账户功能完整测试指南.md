# 港股打新小程序多账户功能完整测试指南

## 测试概览
本文档提供港股打新小程序多账户管理功能的完整测试流程，确保所有功能正常工作。

## 测试环境准备

### 1. 清除数据（可选）
```javascript
// 在开发者工具控制台执行
wx.clearStorageSync()
```

### 2. 测试数据结构
- accounts: 账户列表
- stocks: 打新记录列表
- currentAccountId: 当前选中账户ID

## 核心功能测试

### 一、微信授权登录测试

#### 1.1 测试场景
- [ ] 首次进入小程序，自动跳转登录页面
- [ ] 点击"微信一键登录"按钮
- [ ] 授权成功后获取用户信息
- [ ] 游客模式登录

#### 1.2 验证要点
- 用户头像和昵称正确显示
- 支持新版API和手动授权
- 授权失败时的错误处理
- 游客模式功能正常

### 二、账户管理功能测试

#### 2.1 默认账户创建
- [ ] 首次使用时自动创建"默认账户"
- [ ] 默认账户ID为'default'
- [ ] 账户信息正确保存到本地存储

#### 2.2 新增账户
- [ ] 在"我的"页面点击"管理账户"
- [ ] 点击"新增账户"按钮
- [ ] 输入账户名称（如：个人账户、家庭账户）
- [ ] 验证账户名称重复检查
- [ ] 新账户创建成功提示

#### 2.3 账户切换
- [ ] 在"我的"页面选择不同账户
- [ ] 确认账户切换成功
- [ ] 首页标题显示当前账户名
- [ ] 数据按账户正确过滤

#### 2.4 默认账户设置
- [ ] 长按账户可设置为默认
- [ ] 默认账户标识正确显示
- [ ] 下次打开小程序自动选中默认账户

### 三、数据录入和编辑测试

#### 3.1 新增打新记录
- [ ] 点击首页"新增记录"按钮
- [ ] 选择账户（显示账户选择器）
- [ ] 填写股票信息
- [ ] 保存后数据关联正确账户
- [ ] 返回首页数据正确显示

#### 3.2 编辑打新记录
- [ ] 点击记录进入编辑页面
- [ ] 原账户信息正确显示
- [ ] 重新选择账户
- [ ] 保存后accountId正确更新
- [ ] 数据在对应账户下显示

#### 3.3 无账户时的处理
- [ ] 删除所有账户后新增记录
- [ ] 系统提示创建账户
- [ ] 引导用户创建账户流程

### 四、数据隔离测试

#### 4.1 数据过滤验证
- [ ] 创建多个账户
- [ ] 在不同账户下录入数据
- [ ] 切换账户查看数据隔离效果
- [ ] 首页统计信息独立计算

#### 4.2 页面数据一致性
- [ ] 首页数据按当前账户过滤
- [ ] 历史页面数据按当前账户过滤
- [ ] 统计信息仅计算当前账户数据
- [ ] 详情页面显示正确账户信息

### 五、UI交互测试

#### 5.1 首页UI优化
- [ ] 统计信息容器对齐
- [ ] 按钮宽度为原来一半
- [ ] 导航栏显示当前账户
- [ ] 用户信息栏已移除

#### 5.2 弹窗交互
- [ ] 账户选择弹窗样式美观
- [ ] 新增账户弹窗交互流畅
- [ ] 弹窗关闭功能正常
- [ ] 错误提示显示正确

#### 5.3 我的页面
- [ ] 账户列表正确显示
- [ ] 当前账户高亮显示
- [ ] 默认账户标识清晰
- [ ] 操作按钮功能正常

## 边界情况测试

### 1. 数据兼容性
- [ ] 升级前的旧数据正确处理
- [ ] 缺少accountId的记录自动归类到默认账户
- [ ] 账户删除后关联数据的处理

### 2. 错误处理
- [ ] 网络异常时的处理
- [ ] 数据保存失败的提示
- [ ] 账户名称为空的验证
- [ ] 重复账户名的检查

### 3. 性能测试
- [ ] 大量数据下的加载速度
- [ ] 账户切换的响应时间
- [ ] 数据过滤的性能表现

## 测试数据准备

### 创建测试账户
1. 默认账户（自动创建）
2. 个人账户
3. 家庭账户  
4. 公司账户

### 创建测试记录
每个账户下创建不同状态的记录：
- 打新中的记录
- 已结束的记录
- 有盈利的记录
- 有亏损的记录

## 验证清单

### 数据结构验证
```javascript
// 账户数据结构
{
  id: 'account_1234567890',
  name: '个人账户',
  isDefault: false,
  createTime: 1234567890
}

// 股票记录数据结构
{
  id: 'stock_1234567890',
  stockName: '测试股票',
  accountId: 'account_1234567890',
  // ...其他字段
}
```

### 存储数据验证
```javascript
// 检查本地存储
console.log('accounts:', wx.getStorageSync('accounts'))
console.log('stocks:', wx.getStorageSync('stocks'))
console.log('currentAccountId:', wx.getStorageSync('currentAccountId'))
```

## 回归测试

在完成新功能测试后，还需要验证：
- [ ] 原有功能未受影响
- [ ] 中签记录功能正常
- [ ] 卖出记录功能正常
- [ ] 盈亏计算准确
- [ ] 统计功能正确

## 测试报告模板

### 功能测试结果
- 微信授权登录：✅ 通过
- 账户管理：✅ 通过  
- 数据录入编辑：✅ 通过
- 数据隔离：✅ 通过
- UI交互：✅ 通过

### 发现问题
- 问题描述
- 重现步骤
- 期望结果
- 实际结果
- 修复建议

### 性能表现
- 页面加载时间
- 数据切换响应时间
- 内存使用情况

## 部署前检查

1. [ ] 所有测试用例通过
2. [ ] 代码质量检查
3. [ ] 性能优化验证
4. [ ] 用户体验测试
5. [ ] 数据安全检查

通过以上完整的测试流程，可以确保港股打新小程序的多账户管理功能稳定可靠，为用户提供优质的使用体验。
