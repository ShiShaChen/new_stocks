<!--pages/fund-management/fund-management.wxml-->
<wxs module="formatter" src="../../utils/formatter.wxs"></wxs>

<view class="container">
  <!-- ç²¾ç¾å¤´éƒ¨åŒºåŸŸ -->
  <view class="header-wrapper">
    <view class="header-bg"></view>
    <view class="header-content">
      <view class="header-top">
        <view class="page-title">
          <text class="title-icon">ğŸ’°</text>
          <text class="title-text">èµ„é‡‘ä¸­å¿ƒ</text>
        </view>
        <button class="account-selector" bindtap="onSwitchAccount">
          <text class="account-name">{{currentAccount.name}}</text>
          <text class="dropdown-icon">â–¼</text>
        </button>
      </view>
      
      <!-- ä¸»è¦ä½™é¢å¡ç‰‡ -->
      <view class="balance-card" wx:if="{{accountFunds}}">
        <view class="balance-header">
          <text class="balance-title">è´¦æˆ·ä½™é¢</text>
          <view class="currency-badge">æ¸¯å¸</view>
        </view>
        <view class="balance-main">
          <text class="balance-amount">{{formatter.formatAmount(accountFunds.balances.HKD, 'HKD')}}</text>
          <text class="balance-subtitle">æ€»å¯ç”¨èµ„é‡‘</text>
        </view>
        <view class="balance-stats">
          <view class="stat-item">
            <text class="stat-value">{{formatter.formatAmount(accountFunds.totalDeposit.HKD, 'HKD')}}</text>
            <text class="stat-label">ç´¯è®¡è½¬å…¥</text>
          </view>
          <view class="stat-divider"></view>
          <view class="stat-item">
            <text class="stat-value">{{formatter.formatAmount(accountFunds.totalWithdraw.HKD, 'HKD')}}</text>
            <text class="stat-label">ç´¯è®¡è½¬å‡º</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- å¿«æ·æ“ä½œåŒºåŸŸ -->
  <view class="quick-actions">
    <view class="actions-title">
      <text class="section-icon">âš¡</text>
      <text class="section-text">å¿«æ·æ“ä½œ</text>
    </view>
    <view class="action-grid">
      <button class="action-item deposit" bindtap="onDeposit">
        <view class="action-icon-wrapper">
          <text class="action-icon">â†—ï¸</text>
        </view>
        <text class="action-text">èµ„é‡‘è½¬å…¥</text>
        <text class="action-desc">é“¶è¡Œå…¥é‡‘</text>
      </button>
      
      <button class="action-item withdraw" bindtap="onWithdraw">
        <view class="action-icon-wrapper">
          <text class="action-icon">â†™ï¸</text>
        </view>
        <text class="action-text">èµ„é‡‘è½¬å‡º</text>
        <text class="action-desc">é“¶è¡Œå‡ºé‡‘</text>
      </button>
      
      <button class="action-item detail" bindtap="onViewRecords">
        <view class="action-icon-wrapper">
          <text class="action-icon">ğŸ“Š</text>
        </view>
        <text class="action-text">äº¤æ˜“æ˜ç»†</text>
        <text class="action-desc">æŸ¥çœ‹æµæ°´</text>
      </button>
    </view>
  </view>

  <!-- æœ€è¿‘è®°å½• -->
  <view class="recent-section" wx:if="{{recentRecords.length > 0}}">
    <view class="section-header">
      <view class="section-title-wrapper">
        <text class="section-icon">ğŸ“</text>
        <text class="section-text">æœ€è¿‘è®°å½•</text>
      </view>
      <view class="view-all-btn" bindtap="onViewRecords">
        <text>æŸ¥çœ‹å…¨éƒ¨</text>
        <text class="arrow">â†’</text>
      </view>
    </view>
    
    <view class="record-list">
      <view 
        class="record-card" 
        wx:for="{{recentRecords}}" 
        wx:key="id"
      >
        <view class="record-left">
          <view class="record-icon {{item.type}}">
            <text>{{item.type === 'deposit' ? 'â†—ï¸' : 'â†™ï¸'}}</text>
          </view>
          <view class="record-info">
            <text class="record-type">{{item.type === 'deposit' ? 'èµ„é‡‘è½¬å…¥' : 'èµ„é‡‘è½¬å‡º'}}</text>
            <text class="record-time">{{formatter.formatDate(item.timestamp)}}</text>
          </view>
        </view>
        
        <view class="record-right">
          <text class="record-amount {{item.type}}">
            {{item.type === 'deposit' ? '+' : '-'}}{{formatter.formatAmount(item.amount, item.currency)}}
          </text>
          <view class="record-status {{item.status}}">{{item.status === 'completed' ? 'å·²å®Œæˆ' : 'å¤„ç†ä¸­'}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-section" wx:if="{{recentRecords.length === 0}}">
    <view class="empty-illustration">
      <text class="empty-icon">ğŸ’³</text>
      <text class="empty-text">æš‚æ— èµ„é‡‘è®°å½•</text>
      <text class="empty-desc">å¼€å§‹æ‚¨çš„ç¬¬ä¸€ç¬”èµ„é‡‘è®°å½•</text>
    </view>
    <button class="start-btn" bindtap="onDeposit">
      <text class="btn-icon">+</text>
      <text>å¼€å§‹è®°å½•</text>
    </button>
  </view>

  <!-- å…¨éƒ¨è´¦æˆ·æ±‡æ€» -->
  <view class="summary-section" wx:if="{{fundsSummary && accountList.length > 1}}">
    <view class="summary-header">
      <text class="section-icon">ğŸ¦</text>
      <text class="section-text">å…¨éƒ¨è´¦æˆ·æ±‡æ€»</text>
    </view>
    <view class="summary-card">
      <view class="summary-item">
        <text class="summary-label">æ€»èµ„é‡‘</text>
        <text class="summary-value">{{formatter.formatAmount(fundsSummary.totalBalances.HKD, 'HKD')}}</text>
      </view>
    </view>
  </view>
</view>

<!-- è´¦æˆ·é€‰æ‹©å¼¹çª— -->
<view class="account-modal" wx:if="{{showAccountSelect}}" bindtap="onCloseAccountSelect">
  <view class="modal-content" catchtap>
    <view class="modal-header">
      <text class="modal-title">é€‰æ‹©è´¦æˆ·</text>
    </view>
    
    <view class="account-list">
      <view 
        class="account-item {{currentAccount.id === item.id ? 'active' : ''}}" 
        wx:for="{{accountList}}" 
        wx:key="id"
        bindtap="onSelectAccount"
        data-account="{{item}}"
      >
        <view class="account-info">
          <text class="account-name">{{item.name}}</text>
          <text class="account-desc" wx:if="{{item.isDefault}}">é»˜è®¤è´¦æˆ·</text>
        </view>
        <text class="check-icon" wx:if="{{currentAccount.id === item.id}}">âœ“</text>
      </view>
    </view>
  </view>
</view>
