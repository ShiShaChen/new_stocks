<!--pages/sell-record/sell-record.wxml-->
<view class="container">
  <!-- 股票信息展示 -->
  <view class="stock-info-card">
    <text class="stock-name">{{stockInfo.stockName}}</text>
    <view class="stock-details">
      <text class="detail-item">申购数量：{{stockInfo.subscriptionHands}} 股</text>
      <text class="detail-item">发行价：¥{{stockInfo.issuePrice}}</text>
      <text class="detail-item">中签数：{{stockInfo.winningShares}} 股</text>
      <text class="detail-item">中签金额：¥{{winningAmount}}</text>
    </view>
  </view>

  <!-- 卖出信息录入 -->
  <view class="form-section">
    <view class="section-title">录入卖出信息</view>
    
    <form bindsubmit="onSubmit">
      <view class="form-item">
        <text class="form-label">卖出价格 *</text>
        <input 
          class="form-input" 
          name="sellPrice" 
          type="digit" 
          placeholder="请输入卖出价格" 
          value="{{formData.sellPrice}}"
          bindinput="onSellPriceChange"
        />
      </view>

      <view class="form-item">
        <text class="form-label">卖出股数</text>
        <input 
          class="form-input" 
          name="sellShares" 
          type="number" 
          placeholder="默认全部卖出" 
          value="{{formData.sellShares}}"
          bindinput="onSellSharesChange"
        />
        <text class="form-tip">默认卖出全部中签数：{{stockInfo.winningShares}} 股</text>
      </view>

      <view class="form-item">
        <text class="form-label">卖出日期</text>
        <picker 
          mode="date" 
          value="{{formData.sellDate}}" 
          bindchange="onDateChange"
        >
          <view class="picker-input">
            {{formData.sellDate || '请选择卖出日期'}}
          </view>
        </picker>
      </view>

      <!-- 盈亏计算结果 -->
      <view class="result-preview" wx:if="{{formData.sellPrice && formData.sellPrice > 0}}">
        <view class="preview-title">盈亏计算结果</view>
        
        <!-- 费用明细 -->
        <view class="fee-details">
          <view class="fee-title">卖出费用明细</view>
          <view class="fee-item">
            <text class="fee-label">经纪佣金 (0.15%，最低¥75)：</text>
            <text class="fee-value">¥{{feeDetails.commission}}</text>
          </view>
          <view class="fee-item">
            <text class="fee-label">印花税 (0.1%，向上取整)：</text>
            <text class="fee-value">¥{{feeDetails.stampDuty}}</text>
          </view>
          <view class="fee-item">
            <text class="fee-label">交易徵费 (0.0027%，向上取整+0.01)：</text>
            <text class="fee-value">¥{{feeDetails.tradingLevy}}</text>
          </view>
          <view class="fee-item">
            <text class="fee-label">交易费 (0.00565%)：</text>
            <text class="fee-value">¥{{feeDetails.tradingFee}}</text>
          </view>
          <view class="fee-item">
            <text class="fee-label">结算费 (0.002%，最低¥3)：</text>
            <text class="fee-value">¥{{feeDetails.settlementFee}}</text>
          </view>
          <view class="fee-total">
            <text class="fee-total-label">总费用：</text>
            <text class="fee-total-value">¥{{feeDetails.totalFee}}</text>
          </view>
        </view>
        
        <view class="calculation-detail">
          <view class="calc-item">
            <text class="calc-label">卖出金额：</text>
            <text class="calc-value">¥{{sellAmount}}</text>
          </view>
          <view class="calc-item">
            <text class="calc-label">成本金额：</text>
            <text class="calc-value">¥{{costAmount}}</text>
          </view>
          <view class="calc-item">
            <text class="calc-label">买入总花费：</text>
            <text class="calc-value">¥{{buyFees}}</text>
          </view>
          <view class="calc-item">
            <text class="calc-label">总手续费：</text>
            <text class="calc-value">¥{{totalFees}}</text>
          </view>
          <view class="calc-divider"></view>
          <view class="calc-item profit-result">
            <text class="calc-label">净盈亏：</text>
            <text class="calc-value profit-{{profit >= 0 ? 'positive' : 'negative'}}">
              {{profit >= 0 ? '+' : ''}}¥{{profit}}
            </text>
          </view>
          <view class="calc-item">
            <text class="calc-label">收益率：</text>
            <text class="calc-value profit-{{profitRate >= 0 ? 'positive' : 'negative'}}">
              {{profitRate >= 0 ? '+' : ''}}{{profitRate}}%
            </text>
          </view>
        </view>
      </view>

      <view class="button-group">
        <view bindtap="onSaveSellRecord" class="btn-primary {{!formData.sellPrice ? 'btn-disabled' : ''}}">
          保存卖出记录
        </view>
        <view bindtap="onCancel" class="btn-secondary">
          取消
        </view>
        <view bindtap="finishStock" class="btn-finish">结束打新</view>
      </view>
    </form>
  </view>
</view>
