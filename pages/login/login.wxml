<!--pages/login/login.wxml - 基于基础库3.8.10的现代化登录页面-->
<view class="container">
  <view class="login-header">
    <image class="logo" src="../../images/logo.png" mode="aspectFit"></image>
    <text class="app-name">打新记录</text>
    <text class="app-desc">港股美股打新成本盈利记录</text>
  </view>
  
  <view class="login-content">
    <!-- 已登录状态 -->
    <view wx:if="{{isLoggedIn}}" class="logged-in-section">
      <view class="user-info">
        <image class="avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
        <view class="user-details">
          <text class="nickname">{{userInfo.nickName}}</text>
          <text class="login-time">登录时间：{{userInfo.loginTimeStr || '未知'}}</text>
        </view>
      </view>
      
      <view class="action-buttons">
        <button class="btn-primary" bindtap="navigateToHome">
          进入应用
        </button>
        <button class="btn-secondary" bindtap="logout">
          退出登录
        </button>
      </view>
    </view>

    <!-- 未登录状态 -->
    <view wx:else class="login-section">
      <view class="welcome-info">
        <text class="welcome-title">欢迎使用打新记录</text>
        <text class="welcome-desc">基于最新微信技术，为您提供最佳体验</text>
        <view class="feature-list">
          <text class="feature-item">• 记录个人打新数据</text>
          <text class="feature-item">• 自动计算盈亏情况</text>
          <text class="feature-item">• 历史记录查询</text>
          <text class="feature-item">• 多账户管理</text>
        </view>
      </view>
      
      <view class="login-button-area">
        <button 
          class="btn-login {{isLoading ? 'loading' : ''}}" 
          bindtap="startWXLogin" 
          disabled="{{isLoading}}"
        >
          <text wx:if="{{!isLoading}}">微信一键登录</text>
          <text wx:else>登录中...</text>
        </button>
        <text class="login-tips">支持快速登录和自定义信息两种方式</text>
      </view>
    </view>
  </view>

  <!-- 用户信息授权弹窗 -->
  <view wx:if="{{showAuthModal}}" class="modal-overlay">
    <view class="auth-modal">
      <view class="modal-header">
        <text class="modal-title">设置个人信息</text>
        <text class="modal-desc">请设置您的头像和昵称</text>
      </view>
      
      <view class="modal-body">
        <!-- 头像选择 -->
        <view class="avatar-section">
          <text class="section-label">头像</text>
          <button 
            class="avatar-button" 
            open-type="chooseAvatar" 
            bindchooseavatar="onChooseAvatar"
          >
            <image class="avatar-preview" src="{{tempAvatarUrl}}" mode="aspectFill"></image>
            <view class="avatar-tips">点击选择头像</view>
          </button>
        </view>
        
        <!-- 昵称输入 -->
        <view class="nickname-section">
          <text class="section-label">昵称</text>
          <input 
            class="nickname-input" 
            type="nickname" 
            placeholder="请输入昵称（1-20个字符）"
            value="{{tempNickname}}"
            bindinput="onNicknameInput"
            maxlength="20"
          />
        </view>
      </view>
      
      <view class="modal-footer">
        <button 
          class="btn-cancel" 
          bindtap="cancelAuth"
          disabled="{{isLoading}}"
        >
          取消
        </button>
        <button 
          class="btn-confirm {{isLoading ? 'loading' : ''}}" 
          bindtap="confirmAuth"
          disabled="{{isLoading || !tempNickname}}"
        >
          <text wx:if="{{!isLoading}}">确认</text>
          <text wx:else>保存中...</text>
        </button>
      </view>
    </view>
  </view>
</view>
