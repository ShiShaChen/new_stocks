<!--pages/winning-result/winning-result.wxml-->
<view class="container">
  <!-- 股票信息展示 -->
  <view class="stock-info-card" wx:if="{{stockInfo.stockName}}">
    <text class="stock-name">{{stockInfo.stockName}}</text>
    <view class="stock-details">
      <text class="detail-item">申购数量：{{stockInfo.subscriptionHands}} 股</text>
      <text class="detail-item">发行价：¥{{stockInfo.issuePrice}}</text>
      <text class="detail-item">套餐费用：¥{{stockInfo.packageFee}}</text>
    </view>
  </view>

  <!-- 加载状态 -->
  <view class="loading-state" wx:if="{{!stockInfo.stockName}}">
    <text>正在加载股票信息...</text>
  </view>

  <!-- 中签信息录入 -->
  <view class="form-section" wx:if="{{stockInfo.stockName}}">
    <view class="section-title">录入中签结果</view>
    
    <form bindsubmit="onSubmit">
      <view class="form-item">
        <text class="form-label">中签数 *</text>
        <input 
          class="form-input" 
          name="winningShares" 
          type="number" 
          placeholder="请输入中签数（股）" 
          value="{{formData.winningShares}}"
          bindinput="onWinningSharesChange"
          bindfocus="onInputFocus"
          bindblur="onInputBlur"
          cursor-spacing="50"
          adjust-position="{{true}}"
          hold-keyboard="{{true}}"
          confirm-type="done"
        />
        <text class="form-tip">中签数不能超过申购股数：{{maxWinningShares}} 股</text>
      </view>

      <view class="form-item">
        <text class="form-label">中签日期</text>
        <picker 
          mode="date" 
          value="{{formData.winningDate}}" 
          bindchange="onDateChange"
        >
          <view class="picker-input">
            {{formData.winningDate || '请选择中签日期'}}
          </view>
        </picker>
      </view>

      <!-- 计算结果预览 -->
      <view class="result-preview" wx:if="{{formData.winningShares > 0}}">
        <view class="preview-title">中签结果预览</view>
        <view class="preview-item">
          <text class="preview-label">中签数：</text>
          <text class="preview-value">{{formData.winningShares}} 股</text>
        </view>
        <view class="preview-item">
          <text class="preview-label">中签金额：</text>
          <text class="preview-value">¥{{calculatedAmount}}</text>
        </view>
        <view class="preview-item">
          <text class="preview-label">中签率：</text>
          <text class="preview-value">{{winningRate}}%</text>
        </view>
        
        <!-- 费用明细 -->
        <view class="fee-details">
          <view class="fee-title">应收费用明细</view>
          <view class="fee-item">
            <text class="fee-label">经纪佣金 (1%)：</text>
            <text class="fee-value">¥{{feeDetails.brokerageCommission}}</text>
          </view>
          <view class="fee-item">
            <text class="fee-label">香港联交所交易费 (0.00565%)：</text>
            <text class="fee-value">¥{{feeDetails.tradingFee}}</text>
          </view>
          <view class="fee-item">
            <text class="fee-label">证监会交易会费 (0.0027%)：</text>
            <text class="fee-value">¥{{feeDetails.tradingLevy}}</text>
          </view>
          <view class="fee-item">
            <text class="fee-label">会财局交易会费 (0.00015%)：</text>
            <text class="fee-value">¥{{feeDetails.afrcLevy}}</text>
          </view>
          <view class="fee-item">
            <text class="fee-label">打新套餐费用：</text>
            <text class="fee-value">¥{{feeDetails.packageFee}}</text>
          </view>
          <view class="fee-total">
            <text class="fee-total-label">总费用：</text>
            <text class="fee-total-value">¥{{feeDetails.totalFee}}</text>
          </view>
        </view>
      </view>

      <!-- 按钮组 -->
      <view class="button-group">
        <button formType="submit" class="btn-primary" disabled="{{!formData.winningShares}}">
          保存中签结果
        </button>
        <button type="default" bindtap="onCancel" class="btn-secondary">
          取消
        </button>
      </view>
    </form>
  </view>
</view>
