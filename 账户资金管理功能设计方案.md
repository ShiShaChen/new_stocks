# 账户资金管理功能设计方案

## 📊 功能概述

为每个账户新增完整的资金管理系统，包括资金转入转出记录、与打新业务的自动关联、实时资金余额统计等功能。

## 🎯 核心功能

### 1. 资金记录管理
- 资金转入记录（入金）
- 资金转出记录（出金）
- 支持港币（HKD）和人民币（CNY）
- 时间精确到年月日时分

### 2. 业务关联
- 打新时自动关联账户资金
- 中签时自动扣除资金
- 卖出时计算费用和盈亏
- 自动更新账户余额

### 3. 资金统计
- 单账户资金余额
- 全部账户资金汇总
- 资金流水统计
- 盈亏分析

## 🗂️ 数据结构设计

### 资金记录 (FundRecord)
```javascript
{
  id: "record_20240713_001",
  accountId: "account_001", 
  type: "deposit" | "withdraw", // 入金/出金
  amount: 10000,
  currency: "HKD" | "CNY",
  datetime: "2024-07-13 14:30:00",
  timestamp: 1720857000000,
  description: "银行转账入金",
  status: "completed" | "pending",
  createTime: 1720857000000
}
```

### 账户资金状态 (AccountFunds)
```javascript
{
  accountId: "account_001",
  balances: {
    HKD: 50000,
    CNY: 20000
  },
  totalDeposit: {
    HKD: 100000,
    CNY: 50000
  },
  totalWithdraw: {
    HKD: 30000,
    CNY: 15000
  },
  frozenAmount: {
    HKD: 20000, // 打新冻结资金
    CNY: 15000
  },
  lastUpdateTime: 1720857000000
}
```

### 业务关联记录 (BusinessTransaction)
```javascript
{
  id: "trans_20240713_001",
  accountId: "account_001",
  type: "subscribe" | "allot" | "sell", // 打新/中签/卖出
  stockId: "stock_001",
  amount: 10000,
  currency: "HKD",
  quantity: 1000, // 股数
  fees: 50, // 手续费
  profitLoss: 1000, // 盈亏（卖出时）
  datetime: "2024-07-13 14:30:00",
  relatedRecordId: "record_20240713_001"
}
```

## 🎨 UI界面设计

### 1. 个人资料页面增强
- 账户资金概览卡片
- 总资金统计
- 快速入金/出金入口

### 2. 资金管理页面
- 资金记录列表
- 添加资金记录
- 资金流水筛选

### 3. 资金详情页面
- 单条记录详情
- 编辑和删除功能
- 关联业务显示

## 📱 页面结构

```
pages/
├── profile/              # 个人资料（已有）
├── fund-management/      # 资金管理主页
│   ├── fund-management.js
│   ├── fund-management.wxml
│   └── fund-management.wxss
├── fund-record/          # 添加资金记录
│   ├── fund-record.js
│   ├── fund-record.wxml
│   └── fund-record.wxss
└── fund-detail/          # 资金记录详情
    ├── fund-detail.js
    ├── fund-detail.wxml
    └── fund-detail.wxss
```

## 🔧 技术实现要点

### 1. 数据管理
- 使用本地存储管理资金数据
- 按账户分组存储
- 提供数据同步和备份机制

### 2. 业务集成
- 在打新、中签、卖出时自动调用资金管理API
- 实时更新账户余额
- 提供撤销和回滚机制

### 3. 用户体验
- 直观的资金流水界面
- 便捷的入金出金操作
- 实时的余额更新
- 美观的图表展示

下面开始具体实现...
